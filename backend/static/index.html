<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>ScriptObservatory</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="js/basic.js"></script>
</head>

<body ng-app="app" ng-controller="AppCtrl as app">

<div align="center">
    <h1> ScriptObservatory </h1>
    <a href="#" onclick="by_raw(); return false;">sanity check</a> <br>
    <form ng-submit="submitParentQuery()">
        Submit a Website: <input type="text" name="url" ng-model="parentQueryText" placeholder="URL"/>
        <input type="submit" id="submit" value="Submit" />
    </form>
    <form ng-submit="submitScriptQuery()">
        Submit a Script: <input type="text" placeholder="URL or SHA256" ng-model="scriptQueryText"/>
        <input type="submit" id="submit" value="Submit" />
    </form>



</div>    

<br>

<div id="by_raw" style="display:none">
    <table>
        <th style="width:12%"> Date </th>
        <th style="width:43%"> <input ng-model="search.url" placeholder="Script URL"></th>
        <th style="width:10%"> <input ng-model="search.sha256" placeholder="Hash"></th>
        <th style="width:35%"> <input ng-model="search.parent_url" placeholder="Parent URL"> </th>
        <tr ng-repeat="script in app.records | filter:search | orderBy:'-date'">
            <td>{{ script.date | date:'yyyy-MM-dd HH:mm' }}</td>
            <td>{{ script.url | limitTo: 70 }}{{ script.url.length > 70 ? '...' : '' }}</td>
            <td>{{ script.sha256 | limitTo:10 }}</td>
            <td>{{ script.parent_url | limitTo: 50 }}{{ script.parent_url.length > 50 ? '...' : '' }}</td>
        </tr>
    </table>
</div>

<div id="by_url" style="display:none">
<pre>
    <i>coming soon...</i>
    <br>
    www.google-analytics.com/ga.js          parent #1 (hash #1), parent #2 (hash #1, hash #2), parent #3 (hash #2)
    www.jquery.org/jquery.js                parent #1 (hash #1)
</pre>    
</div>

<div id="by_parent" style="display:none">
    <table style="border: 1px dotted black;">
        <th style="border: 1px dotted black; width:30%"> 
            Site URL <input ng-model="search.url" placeholder="Filter by URL">
        </th>
        <th style="border: 1px dotted black; width:4%"> N </th>
        <th style="border: 1px dotted black; width:65%"> Scripts </th>
        <tr ng-repeat="site in app.sites | filter:search.url | orderBy:'-occur'">
            <pre>
            <td style="border: 1px dotted black;">{{ site.url | limitTo: 67 }}{{ site.url.length > 67 ? '...' : '' }}</td>
            <td style="border: 1px dotted black;">{{ site.occur }}</td>
            <td style="border: 1px dotted black;">
                <table>
                <tr ng-repeat="script in site.scripts | object2Array | orderBy:'-occur'"> 
                    <td style="width:55%;"> {{ script.url | limitTo:67 }}{{ script.url.length > 67 ? '...':'' }} </td>
                    <td style="width:10%;"> {{ script.occur.toFixed(1) }}% </td>
                    <td style="width:35%;">
                        <span ng-repeat="hash in script.hashes | object2Array | orderBy:'-occur'"> 
                            {{ hash.sha256 | limitTo:10 }} ({{ hash.occur.toFixed(1) }}%){{ $last ? '' : ', '}}
                        </span>
                    </td>
                </tr>
                </table>
            </td>
            </pre>
        <tr>
    </table>

</div>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
<script src="js/app.js"></script>

</body>
</html>
